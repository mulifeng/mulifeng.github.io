---
title: ""
---


```{r, echo=FALSE, warnings=FALSE, message=FALSE, fig.align='center'}
# 聚明胶肽绘图
library(ggplot2)
library(openxlsx)
library(dplyr)
library(ggthemes)

data <- read.xlsx("190713.xlsx")

# 箱线图
p <- ggplot(data) +
  geom_boxplot(aes(x = product, y = xhd, fill = batch)) +
  # geom_hline(yintercept = 1.5) +
  # geom_hline(yintercept = 2.9) +
  annotate("rect", ymin = 0.015, ymax = 0.029, xmin = 0, xmax = 6, fill = "blue", alpha = 0.1) +
  ylab("酰化度") + 
  xlab("品种") +
  #annotate("text", x = 1.3, y = 0.0285, size = 5, label = "酰化度标准规定：1.5% ~ 2.9%") +
  scale_x_discrete(breaks = c("A", "B", "C", "D", "xuepai"),
                   labels = c("A", "B", "C", "D", "雪派")) +
  scale_y_continuous(breaks = c(0.01, 0.015, 0.02, 0.025, 0.03),
                     labels = scales::percent,
                     limits = c(0.0145, 0.03))+
  theme_light() +
  ggtitle("雪派??与4种市售产品的酰化度比较") +
  theme_wsj()

# 酰化值
p1 <- ggplot(data, aes(x = num, y = xhd, fill = product)) + 
  geom_bar(position = "dodge", stat = "identity") + 
  scale_fill_manual(values = c("#330099","#6699FF","#9966CC","#660066","#00FF00"),
                    name = "产品",
                    breaks = c("A", "B", "C", "D", "xuepai"),
                    labels = c("A", "B", "C", "D", "雪派")) +
  scale_x_discrete(
    breaks = c("A1", "A2","A3","B1","B2","B3","C1","C2","C3","D1", "D2", "D3", "xp1", "xp2","xp3"),
    labels = c("A1", "A2","A3","B1","B2","B3","C1","C2","C3","D1", "D2", "D3", "雪派-1", "雪派-2", "雪派-3")) +
  scale_y_continuous(limits = c(0, 0.03),
    breaks = c(0.01, 0.015, 0.02, 0.025, 0.03),
                     labels = scales::percent) +
  ylab("酰化度") + 
  xlab("品种") +
  #ggtitle(paste("雪派??", "与4种市售产品的酰化度比较")) +
  ggtitle(~ paste("雪派" ^ "\U00AE", "与4种市售产品的酰化度比较")) +
    #ggtitle(STR1)+
  annotate("rect", ymin = 0.015, ymax = 0.029, xmin = 0, xmax = 16, fill = "red", alpha = 0.05) +
  theme_wsj()
  #annotate("text", x = 2.8, y = 0.0285, size = 5, label = "酰化度标准规定：1.5% ~ 2.9%"))

# library(export)
# graph2ppt(p1, file = "xianhuadu.pptx", aspectr = 1.618, width = 10)


# 交联剂残留
p2 <- ggplot(data, aes(x = num, y = jljcl, fill = product)) + 
  geom_bar(position = "dodge", stat = "identity") + 
  scale_fill_manual(values = c("#99CCCC","#669999","#CCFFCC","#99CC66","#00FF00"),
                    name = "产品",
                    breaks = c("A", "B", "C", "D", "xuepai"),
                    labels = c("A", "B", "C", "D", "雪派")) +
  scale_x_discrete(
    breaks = c("A1", "A2","A3","B1","B2","B3","C1","C2","C3","D1", "D2", "D3", "xp1", "xp2","xp3"),
    labels = c("A1", "A2","A3","B1","B2","B3","C1","C2","C3","D1", "D2", "D3", "雪派-1", "雪派-2", "雪派-3")) +
  scale_y_continuous(limits = c(0, 520),
                     breaks = c(0, 100, 200, 300, 400, 500)) +
  ylab("交联剂残留量") + 
  xlab("品种") +
  ggtitle("雪派??与4种市售产品的交联剂残留量比较") +
    theme_wsj()
  #annotate("rect", ymin = 0.015, ymax = 0.029, xmin = 0, xmax = 16, fill = "red", alpha = 0.05) +
  #annotate("text", x = 3.5, y = 520, size = 5, label = "交联剂残留量标准规定：≤ 500mg/L"))

# graph2ppt(p2, file = "jljcl.pptx", aspectr = 1.618, width = 10)


# 重均分子量
p3 <- ggplot(data, aes(x = num, y = zjfzl, fill = product)) + 
  geom_bar(position = "dodge", stat = "identity") + 
  scale_fill_manual(values = c("#9999CC","#666699","#9999FF","#CCCCFF","#00FF00"),
                    name = "产品",
                    breaks = c("A", "B", "C", "D", "xuepai"),
                    labels = c("A", "B", "C", "D", "雪派")) +
  scale_x_discrete(
    breaks = c("A1", "A2","A3","B1","B2","B3","C1","C2","C3","D1", "D2", "D3", "xp1", "xp2","xp3"),
    labels = c("A1", "A2","A3","B1","B2","B3","C1","C2","C3","D1", "D2", "D3", "雪派-1", "雪派-2", "雪派-3")) +
  scale_y_continuous(limits = c(0, 4),
                     breaks = c(0, 0.5, 1, 1.5, 2, 2.5, 3, 3.5, 4)) +
  ylab("重均分子量") + 
  xlab("品种") +
  ggtitle("雪派??与4种市售产品的重均分子量比较") +
  annotate("rect", ymin = 2.75, ymax = 3.85, xmin = 0, xmax = 16, fill = "blue", alpha = 0.1) +
    theme_wsj()
  #annotate("text", x = 3.5, y = 3.75, size = 5, label = "重均分子量标准规定：2.75万~3.85万"))

# graph2ppt(p3, file = "zjfzl.pptx", aspectr = 1.618, width = 10)


# 游离氨基
p4 <- ggplot(data, aes(x = num, y = ylaj, fill = product)) + 
  geom_bar(position = "dodge", stat = "identity") + 
  scale_fill_manual(values = c("#789262","#549688","#48C0A3","#7BCFA6","#00FF00"),
                    name = "产品",
                    breaks = c("A", "B", "C", "D", "xuepai"),
                    labels = c("A", "B", "C", "D", "雪派")) +
  scale_x_discrete(
    breaks = c("A1", "A2","A3","B1","B2","B3","C1","C2","C3","D1", "D2", "D3", "xp1", "xp2","xp3"),
    labels = c("A1", "A2","A3","B1","B2","B3","C1","C2","C3","D1", "D2", "D3", "雪派-1", "雪派-2", "雪派-3")) +
  scale_y_continuous(limits = c(0, 0.75),
                     breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7)) +
  ylab("游离氨基值") + 
  xlab("品种") +
  ggtitle("雪派??与4种市售产品的游离氨基值比较") +
  annotate("rect", ymin = 0.5, ymax = 0.65, xmin = 0, xmax = 16, fill = "blue", alpha = 0.1) +
    theme_wsj()
  #annotate("text", x = 3.2, y = 0.68, size = 5, label = "游离氨基值标准规定：0.50 ~ 0.65"))

# graph2ppt(p4, file = "ylajz.pptx", aspectr = 1.618, width = 10)


library(cowplot)
p <- plot_grid(p1, p2, p3, p4, ncol = 1,
               labels = paste(LETTERS[1:4], ")"),
               label_size = 20)
p
```
